<!DOCTYPE html>
<html>
<head>
  <title>Test No Warnings</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
    .pass { color: #0f0; }
    .fail { color: #f00; }
    #log { white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Testing Control Registration (No Warnings Expected)</h1>
  <div id="status">Loading...</div>
  <div id="log"></div>

  <script type="module">
    const statusEl = document.getElementById('status');
    const logEl = document.getElementById('log');

    // Capture console warnings
    const warnings = [];
    const originalWarn = console.warn;
    console.warn = function(...args) {
      warnings.push(args.join(' '));
      originalWarn.apply(console, args);
      logEl.textContent += 'WARN: ' + args.join(' ') + '\n';
    };

    try {
      // Import the ControlsManager which should trigger registration
      const { ControlsManager } = await import('./js/controls/ControlsManager.js');
      const { ControlRegistry } = await import('./js/controls/ControlRegistry.js');

      logEl.textContent += '\n✓ ControlsManager imported successfully\n';

      // Check registered types
      const types = ControlRegistry.getTypes();
      logEl.textContent += `\n✓ Registered control types: ${types.join(', ')}\n`;

      // Create a dummy simulation and visualizer for testing
      const dummySim = { gridSize: 128 };
      const dummyVis = { canvas: null };

      // Instantiate ControlsManager (this calls _registerControlTypes)
      const manager = new ControlsManager(dummySim, dummyVis);
      logEl.textContent += '\n✓ ControlsManager instantiated\n';

      // Check for warnings
      if (warnings.length === 0) {
        statusEl.innerHTML = '<span class="pass">✓ PASS: No registration warnings!</span>';
        logEl.textContent += '\n✓ No "Overwriting existing registration" warnings detected\n';
      } else {
        statusEl.innerHTML = '<span class="fail">✗ FAIL: Warnings detected</span>';
        logEl.textContent += '\n✗ Warnings found:\n';
        warnings.forEach(w => {
          logEl.textContent += '  - ' + w + '\n';
        });
      }

      // Test that we can create controls from each type
      logEl.textContent += '\n--- Testing Control Creation ---\n';
      const testConfigs = [
        { type: 'slider', id: 'test-slider', label: 'Test Slider', min: 0, max: 100, value: 50 },
        { type: 'button', id: 'test-button', label: 'Test Button', text: 'Click' },
        { type: 'radio', id: 'test-radio', label: 'Test Radio', options: [{value: 'a', label: 'A'}] },
        { type: 'select', id: 'test-select', label: 'Test Select', options: [{value: 'a', label: 'A'}] },
        { type: 'canvas', id: 'test-canvas', label: 'Test Canvas', width: 100, height: 100 },
        { type: 'display', id: 'test-display', label: 'Test Display', getValue: () => 'test' },
        { type: 'textinput', id: 'test-textinput', label: 'Test Input', inputType: 'text' }
      ];

      for (const config of testConfigs) {
        try {
          const control = ControlRegistry.create(config);
          logEl.textContent += `✓ Created ${config.type} control\n`;
        } catch (error) {
          logEl.textContent += `✗ Failed to create ${config.type}: ${error.message}\n`;
        }
      }

    } catch (error) {
      statusEl.innerHTML = '<span class="fail">✗ FAIL: ' + error.message + '</span>';
      logEl.textContent += '\n✗ Error: ' + error.stack + '\n';
    }

    // Restore console.warn
    console.warn = originalWarn;
  </script>
</body>
</html>
