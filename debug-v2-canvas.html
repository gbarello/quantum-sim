<!DOCTYPE html>
<html>
<head>
    <title>VisualizerV2 Canvas Debug</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        canvas { border: 2px solid red; display: block; margin: 20px 0; }
        pre { background: #f0f0f0; padding: 10px; }
    </style>
</head>
<body>
    <h1>VisualizerV2 Canvas Debug</h1>
    <canvas id="test-canvas" style="width: 400px; height: 400px;"></canvas>
    <pre id="debug-output"></pre>

    <script type="module">
        import { QuantumSimulation } from './js/quantum.js';
        import { VisualizerV2 } from './js/visualization/VisualizerV2.js';

        const canvas = document.getElementById('test-canvas');
        const output = document.getElementById('debug-output');

        // Create simulation
        const config = {
            gridSize: 128,
            domainSize: 10.0,
            dt: 0.01,
            timeScale: 1.0,
            stepsPerFrame: 5,
            boundaryCondition: 'periodic'
        };
        const simulation = new QuantumSimulation(config);
        simulation.initialize({
            centerX: 64,
            centerY: 64,
            width: 0.6,
            momentumX: 1.0,
            momentumY: 0.5
        });

        // Create visualizer
        const visualizer = new VisualizerV2(canvas, simulation, {
            visualizationMode: 'full',
            saturationScale: 5.0,
            showPotentialPlot: false
        });

        // Debug info
        const rect = canvas.getBoundingClientRect();
        const dpr = window.devicePixelRatio || 1;
        const layout = visualizer.layout ? visualizer.layout.calculateLayout() : null;

        let debugText = `Canvas Debug Info:\n`;
        debugText += `===================\n\n`;
        debugText += `Display (CSS) dimensions: ${rect.width} x ${rect.height}\n`;
        debugText += `Device Pixel Ratio: ${dpr}\n`;
        debugText += `Canvas physical pixels: ${canvas.width} x ${canvas.height}\n`;
        debugText += `Visualizer.width/height: ${visualizer.width} x ${visualizer.height}\n`;
        debugText += `\n`;

        if (layout) {
            debugText += `Layout bounds (wavefunction):\n`;
            debugText += `  x: ${layout.wavefunction.x}\n`;
            debugText += `  y: ${layout.wavefunction.y}\n`;
            debugText += `  width: ${layout.wavefunction.width}\n`;
            debugText += `  height: ${layout.wavefunction.height}\n`;
            debugText += `\n`;
        }

        if (visualizer.panels && visualizer.panels.wavefunction) {
            const panel = visualizer.panels.wavefunction;
            debugText += `WavefunctionPanel bounds:\n`;
            debugText += `  x: ${panel.bounds.x}\n`;
            debugText += `  y: ${panel.bounds.y}\n`;
            debugText += `  width: ${panel.bounds.width}\n`;
            debugText += `  height: ${panel.bounds.height}\n`;
        }

        output.textContent = debugText;

        // Try to render
        console.log('Attempting render...');
        try {
            visualizer.render();
            output.textContent += `\n✓ Render successful!\n`;
        } catch (e) {
            output.textContent += `\n✗ Render failed: ${e.message}\n`;
            console.error(e);
        }
    </script>
</body>
</html>
